<?xml version="1.0" encoding="UTF-8"?>

<flow xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
      xmlns="http://www.springframework.org/schema/webflow"
      xsi:schemaLocation="http://www.springframework.org/schema/webflow
              http://www.springframework.org/schema/webflow/spring-webflow.xsd"
      parent="account/internal">

    <var name="resetPasswordFormBean" class="io.cos.cas.account.model.ResetPasswordFormBean" />

    <view-state id="viewResetPasswordPage" view="/WEB-INF/view/jsp/accountManager/casResetPasswordView.jsp" model="resetPasswordFormBean">
        <binder>
            <binding property="action" />
            <binding property="username" />
            <binding property="newPassword" />
            <binding property="confirmPassword" />
            <binding property="verificationCode" />
        </binder>
        <on-entry>
            <set name="viewScope.commandName" value="'resetPasswordFormBean'"/>
        </on-entry>
        <transition on="submit" bind="true" validate="true" to="resetPassword"/>
    </view-state>

    <action-state id="resetPassword">
        <evaluate expression="resetPasswordAction.submitForm(flowRequestContext, flowScope.resetPasswordFormBean, messageContext)" />
        <transition on="redirect" to="finishLogin" />
        <transition on="error" to="viewResetPasswordPage" />
    </action-state>

</flow>

